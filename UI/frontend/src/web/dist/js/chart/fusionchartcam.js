
// const dataSource = {
//
// };
// var json =[
//     {
//         operation_type:"Parking Area Clear",
//         status:"start",
//         event_time:"00:30:00"
//     },
//     {
//         operation_type:"Aircraft parked",
//         status:"start",
//         event_time:"07:40:00"
//     },{
//         operation_type:"Aircraft parked",
//         status:"end",
//         event_time:"9:00:00 ",
//     },{
//         operation_type:"Aircraft parked",
//         status:"start",
//         event_time:"10:00:00"
//     },{
//         operation_type:"Aircraft parked",
//         status:"end",
//         event_time:"13:00:00"
//     },
//     {
//         operation_type:"Aircraft arriving",
//         status:"start",
//         event_time:"00:35:00"
//     },
//     {
//         operation_type:"Tyre block",
//         status:"start",
//         event_time:"11:40:00"
//     }
// ];



var taskDXb=[
    {
        processid: "EMP120",
        start: "00:00:00",
        end: "00:00:00",
        height: "8",
        topPadding:"10"
        // label: "Running"
    },
    {
        processid: "EMP120",
        start: "00:00:00",
        end: "00:00:00",
        height: "8",
        topPadding:"8"
        // label: "Morning Shift"
    },
    {
        processid: "EMP120",
        start: "00:00:00",
        end: "00:00:00",
        height: "8",
        topPadding:"8"
        // label: "Morning Shift"
    },
    {
        processid: "EMP120",
        start: "00:00:00",
        end: "00:00:00",
        height: "8",
        topPadding:"8"
        // label: "Morning Shift"
    },
    {
        processid: "EMP120",
        start: "00:00:00",
        end: "00:00:00",
        height: "8",
        topPadding:"8"
        // label: "Morning Shift"
    },
    {
        processid: "EMP120",
        start: "00:00:00",
        end: "00:00:00",
        height: "8",
        topPadding:"8"
        // label: "Morning Shift"
    },
    {
        processid: "EMP121",
        start: "00:00:00",
        end: "00:00:00",
        height: "8",
        topPadding:"8"
        // label: "Afternoon Shift"
    },
    {
        processid: "EMP121",
        start: "00:00:00",
        end: "00:00:00",
        height: "8",
        topPadding:"8"
        // label: "Afternoon Shift"
    },
    {
        processid: "EMP121",
        start: "00:00:00",
        end: "00:00:00",
        height: "8",
        topPadding:"8"
        // label: "Afternoon Shift"
    },
    {
        processid: "EMP121",
        start: "00:00:00",
        end: "00:00:00",
        height: "8",
        topPadding:"8"
        // label: "Afternoon Shift"
    },
    {
        processid: "EMP121",
        start: "00:00:00",
        end: "00:00:00",
        height: "8",
        topPadding:"8"
        // label: "Afternoon Shift"
    },
    {
        processid: "EMP121",
        start: "00:00:00",
        end: "00:00:00",
        height: "8",
        topPadding:"8"
        // label: "Eve"
    },
    {
        processid: "EMP122",
        start: "00:00:00",
        end: "00:00:00",
        height: "8",
        topPadding:"8"
        // label: "Half Day"
    },
    {
        processid: "EMP122",
        start: "00:00:00",
        end: "00:00:00",
        height: "8",
        topPadding:"8"
        // label: "Half Day"
    },
    {
        processid: "EMP122",
        start: "00:00:00",
        end: "00:00:00",
        height: "8",
        topPadding:"8"
        // label: "Half Day"
    },
    {
        processid: "EMP122",
        start: "00:00:00",
        end: "00:00:00",
        height: "8",
        topPadding:"8"
        // label: "Half Day"
    },
    {
        processid: "EMP122",
        start: "00:00:00",
        end: "00:00:00",
        height: "8",
        topPadding:"8"
        // label: "Half Day"
    },
    {
        processid: "EMP122",
        start: "00:00:00",
        end: "00:00:00",
        height: "8",
        topPadding:"8"
        // label: "Half Day"
    },
    {
        processid: "EMP123",
        start: "00:00:00",
        end: "00:00:00",
        height: "8",
        topPadding:"8"
        // label: "Morning Shift"
    },
    {
        processid: "EMP123",
        start: "00:00:00",
        end: "00:00:00",
        height: "8",
        topPadding:"8"
        // label: "Morning Shift"
    },
    {
        processid: "EMP123",
        start: "00:00:00",
        end: "00:00:00",
        height: "8",
        topPadding:"8"
        // label: "Morning Shift"
    },
    {
        processid: "EMP123",
        start: "00:00:00",
        end: "00:00:00",
        height: "8",
        topPadding:"8"
        // label: "Morning Shift"
    },
    {
        processid: "EMP123",
        start: "00:00:00",
        end: "00:00:00",
        height: "8",
        topPadding:"8"
        // label: "Morning Shift"
    },
    {
        processid: "EMP123",
        start: "00:00:00",
        end: "00:00:00",
        height: "8",
        topPadding:"8"
        // label: "Morning Shift"
    },
    {
        processid: "EMP124",
        start: "00:00:00",
        end: "00:00:00",
        height: "8",
        topPadding:"8"
        // label: "Afternoon Shift"
    },{
        processid: "EMP124",
        start: "00:00:00",
        end: "00:00:00",
        height: "8",
        topPadding:"8"
        // label: "Afternoon Shift"
    },{
        processid: "EMP124",
        start: "00:00:00",
        end: "00:00:00",
        height: "8",
        topPadding:"8"
        // label: "Afternoon Shift"
    },{
        processid: "EMP124",
        start: "00:00:00",
        end: "00:00:00",
        height: "8",
        topPadding:"8"
        // label: "Afternoon Shift"
    },{
        processid: "EMP124",
        start: "00:00:00",
        end: "00:00:00",
        height: "8",
        topPadding:"8"
        // label: "Afternoon Shift"
    },{
        processid: "EMP124",
        start: "00:00:00",
        end: "00:00:00",
        height: "8",
        topPadding:"8"
        // label: "Afternoon Shift"
    },
    {
        processid: "EMP125",
        start: "00:00:00",
        end: "00:00:00",
        height: "8",
        topPadding:"8"
        // label: "Early Morning support"
    },{
        processid: "EMP125",
        start: "00:00:00",
        end: "00:00:00",
        height: "8",
        topPadding:"8"
        // label: "Early Morning support"
    },{
        processid: "EMP125",
        start: "00:00:00",
        end: "00:00:00",
        height: "8",
        topPadding:"8"
        // label: "Early Morning support"
    },{
        processid: "EMP125",
        start: "00:00:00",
        end: "00:00:00",
        height: "8",
        topPadding:"8"
        // label: "Early Morning support"
    },{
        processid: "EMP125",
        start: "00:00:00",
        end: "00:00:00",
        height: "8",
        topPadding:"8"
        // label: "Early Morning support"
    },{
        processid: "EMP125",
        start: "00:00:00",
        end: "00:00:00",
        height: "8",
        topPadding:"8"
        // label: "Early Morning support"
    },
    {
        processid: "EMP126",
        start: "00:00:00",
        end: "00:00:00",
        height: "8",
        topPadding:"8"
        // label: "Half Day"
    },{
        processid: "EMP126",
        start: "00:00:00",
        end: "00:00:00",
        height: "8",
        topPadding:"8"
        // label: "Half Day"
    },{
        processid: "EMP126",
        start: "00:00:00",
        end: "00:00:00",
        height: "8",
        topPadding:"8"
        // label: "Half Day"
    },{
        processid: "EMP126",
        start: "00:00:00",
        end: "00:00:00",
        height: "8",
        topPadding:"8"
        // label: "Half Day"
    },{
        processid: "EMP126",
        start: "00:00:00",
        end: "00:00:00",
        height: "8",
        topPadding:"8"
        // label: "Half Day"
    },{
        processid: "EMP126",
        start: "00:00:00",
        end: "00:00:00",
        height: "8",
        topPadding:"8"
        // label: "Half Day"
    },
    {
        processid: "EMP127",
        start: "00:00:00",
        end: "00:00:00",
        height: "8",
        topPadding:"8"
        // label: "Half Day"
    },{
        processid: "EMP127",
        start: "00:00:00",
        end: "00:00:00",
        height: "8",
        topPadding:"8"
        // label: "Half Day"
    },{
        processid: "EMP127",
        start: "00:00:00",
        end: "00:00:00",
        height: "8",
        topPadding:"8"
        // label: "Half Day"
    },{
        processid: "EMP127",
        start: "00:00:00",
        end: "00:00:00",
        height: "8",
        topPadding:"8"
        // label: "Half Day"
    },{
        processid: "EMP127",
        start: "00:00:00",
        end: "00:00:00",
        height: "8",
        topPadding:"8"
        // label: "Half Day"
    },{
        processid: "EMP127",
        start: "00:00:00",
        end: "00:00:00",
        height: "8",
        topPadding:"8"
        // label: "Half Day"
    },
    {
        processid: "EMP128",
        start: "00:00:00",
        end: "00:00:00",
        height: "8",
        topPadding:"8"
        // label: "Half Day"
    },{
        processid: "EMP128",
        start: "00:00:00",
        end: "00:00:00",
        height: "8",
        topPadding:"8"
        // label: "Half Day"
    },{
        processid: "EMP128",
        start: "00:00:00",
        end: "00:00:00",
        height: "8",
        topPadding:"8"
        // label: "Half Day"
    },{
        processid: "EMP128",
        start: "00:00:00",
        end: "00:00:00",
        height: "8",
        topPadding:"8"
        // label: "Half Day"
    },{
        processid: "EMP128",
        start: "00:00:00",
        end: "00:00:00",
        height: "8",
        topPadding:"8"
        // label: "Half Day"
    },{
        processid: "EMP128",
        start: "00:00:00",
        end: "00:00:00",
        height: "8",
        topPadding:"8"
        // label: "Half Day"
    },
    {
        processid: "EMP129",
        start: "00:00:00",
        end: "00:00:00",
        height: "8",
        topPadding:"8"
        // label: "Half Day"
    },{
        processid: "EMP129",
        start: "00:00:00",
        end: "00:00:00",
        height: "8",
        topPadding:"8"
        // label: "Half Day"
    },{
        processid: "EMP129",
        start: "00:00:00",
        end: "00:00:00",
        height: "8",
        topPadding:"8"
        // label: "Half Day"
    },{
        processid: "EMP129",
        start: "00:00:00",
        end: "00:00:00",
        height: "8",
        topPadding:"8"
        // label: "Half Day"
    },{
        processid: "EMP129",
        start: "00:00:00",
        end: "00:00:00",
        height: "8",
        topPadding:"8"
        // label: "Half Day"
    },{
        processid: "EMP129",
        start: "00:00:00",
        end: "00:00:00",
        height: "8",
        topPadding:"8"
        // label: "Half Day"
    },
    {
        processid: "EMP130",
        start: "00:00:00",
        end: "00:00:00",
        height: "8",
        topPadding:"8"
        // label: "Half Day"
    },{
        processid: "EMP130",
        start: "00:00:00",
        end: "00:00:00",
        height: "8",
        topPadding:"8"
        // label: "Half Day"
    },{
        processid: "EMP130",
        start: "00:00:00",
        end: "00:00:00",
        height: "8",
        topPadding:"8"
        // label: "Half Day"
    },{
        processid: "EMP130",
        start: "00:00:00",
        end: "00:00:00",
        height: "8",
        topPadding:"8"
        // label: "Half Day"
    },{
        processid: "EMP130",
        start: "00:00:00",
        end: "00:00:00",
        height: "8",
        topPadding:"8"
        // label: "Half Day"
    },{
        processid: "EMP130",
        start: "00:00:00",
        end: "00:00:00",
        height: "8",
        topPadding:"8"
        // label: "Half Day"
    },
    {
        processid: "EMP131",
        start: "00:00:00",
        end: "00:00:00",
        height: "8",
        topPadding:"8"
        // label: "Half Day"
    },{
        processid: "EMP131",
        start: "00:00:00",
        end: "00:00:00",
        height: "8",
        topPadding:"8"
        // label: "Half Day"
    },{
        processid: "EMP131",
        start: "00:00:00",
        end: "00:00:00",
        height: "8",
        topPadding:"8"
        // label: "Half Day"
    },{
        processid: "EMP131",
        start: "00:00:00",
        end: "00:00:00",
        height: "8",
        topPadding:"8"
        // label: "Half Day"
    },{
        processid: "EMP131",
        start: "00:00:00",
        end: "00:00:00",
        height: "8",
        topPadding:"8"
        // label: "Half Day"
    },{
        processid: "EMP131",
        start: "00:00:00",
        end: "00:00:00",
        height: "8",
        topPadding:"8"
        // label: "Half Day"
    }
];
var update_task_end_flags = Array(taskDXb.length).fill(0);
var countnum=1;
var test1;
var test2;


FusionCharts.ready(function() {

    var chartconf={
        dateformat: "dd/mm/yyyy",
        outputdateformat: "dd/mm/yyyy hh12:mn:ss ampm",
        canvasborderalpha: "40",
        ganttlinealpha: "50",
        theme: "candy",

    }
    setTimeout(updateGanttChart, 3000);


    function  updateGanttChart (){

        var json=JSON.parse(localStorage.getItem('EventsDXB'));
        var d = Date.now();

        var options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
        var today  = new Date();
        d = new Date(d);
        d = d.getHours()+':'+d.getMinutes()+':'+d.getSeconds();
        var item_list=['Parking Area Clear','Aircraft Arriving','Aircraft Parked','Tyre Blocks Applied','Staircase/PBB','Cargo Operation','Fuel Operation','Catering Operation','GPU Operation','AC Operation','WV/LV Operation','Aircraft Towing Away']
        var operation_counter=Array(item_list.length).fill(0);

        var startTimeFlight;
        var endTimeFlight;
        for(k=0;k<item_list.length;k++){
            for(i=0;i<json.length;i++){
                if(json[i].operation_type==item_list[k]){
                    if (json[i].operation_status=='start'){
                        //alert(item_list[k])
                        taskDXb[k*6+operation_counter[k]].start=json[i].event_time;
                        // taskDXb[k*2+operation_counter[k]].label = json[i].operation_type;
                    }
                    if (json[i].operation_status=='end'){
                        taskDXb[k*6+operation_counter[k]].end=json[i].event_time;
                        taskDXb[k*6+operation_counter[k]].status = 'end';
                        // taskDXb[k*6+operation_counter[k]].label = 'Completed'
                        operation_counter[k]=operation_counter[k]+1;
                    }

                }
            }
        }


        for(m=0;m<json.length;m++){
            if(json[m].operation_type == "Parking Area Clear" && json[m].operation_status == "start"){
                startTimeFlight =json[m].event_time;
                test1=startTimeFlight;
                break;
            }else {
                var endtodayDate = new Date();
                endtodayDate.setMinutes(endtodayDate.getMinutes() - 30);
                startTimeFlight = endtodayDate.toLocaleDateString('en-US',{weekday: 'long'}) + " "+ endtodayDate.toLocaleDateString('en-US',{day: 'numeric'}) +" "+endtodayDate.toLocaleDateString('en-US',{month: 'long'})+" "+endtodayDate.toLocaleDateString('en-US',{year: 'numeric'})+ " "+ endtodayDate.getHours()+':'+endtodayDate.getMinutes()+':'+endtodayDate.getSeconds();
                test1=startTimeFlight
            }
        }

        for(n=0;n<json.length;n++){
            if(json[n].operation_type == "Aircraft Towing Away" && json[n].operation_status == "end"){
                // if(json[m].operation_status == "end"){
                endTimeFlight =json[n].event_time;
                test2 =endTimeFlight;
                break;
                // }

            }else {
                var endtodayDate = new Date();
                endtodayDate.setMinutes(endtodayDate.getMinutes() + 30);
                endTimeFlight =endtodayDate.toLocaleDateString('en-US',{weekday: 'long'}) + " "+ endtodayDate.toLocaleDateString('en-US',{day: 'numeric'}) +" "+endtodayDate.toLocaleDateString('en-US',{month: 'long'})+" "+endtodayDate.toLocaleDateString('en-US',{year: 'numeric'})+ " "+ endtodayDate.getHours()+':'+endtodayDate.getMinutes()+':'+endtodayDate.getSeconds();
                test2=endTimeFlight;

            }

        }

        for(j=0;j<taskDXb.length;j++){
            if (taskDXb[j].start != '00:00:00' && taskDXb[j].end=='00:00:00' || taskDXb[j].status =='running' ){
                taskDXb[j].end= today.toLocaleDateString('en-US',{weekday: 'long'}) + " "+ today.toLocaleDateString('en-US',{day: 'numeric'}) +" "+today.toLocaleDateString('en-US',{month: 'long'})+" "+today.toLocaleDateString('en-US',{year: 'numeric'})+ " "+ d;
                taskDXb[j].status = 'running'

            }
        }

        // console.log(taskDXb);




        myChart.setJSONData({
            tasks: {
                showlabels: "1",
                color: "#57b955",
                task: taskDXb
            },
            processes: {
                fontsize: "12",
                isbold: "1",
                align: "Center",
                headertext: "Events",
                headerfontsize: "14",
                headervalign: "middle",
                headeralign: "center",
                headerbgcolor:"#262a33",
                process: [
                    {
                        label: "Parking Area Clear",
                        id: "EMP120"
                    },
                    {
                        label: "Aircraft Arriving",
                        id: "EMP121"
                    },
                    {
                        label: "Aircraft Parked",
                        id: "EMP122"
                    },
                    {
                        label: "Tyre block Applied",
                        id: "EMP123"
                    },
                    {
                        label: "PBS Connected",
                        id: "EMP124"
                    },
                    {
                        label: "Cargo Operation",
                        id: "EMP125"
                    },
                    {
                        label: "Fuel Operation",
                        id: "EMP126"
                    },
                    {
                        label: "Catering operation",
                        id: "EMP127"
                    },
                    {
                        label: "GPU Operation",
                        id: "EMP128"
                    },
                    {
                        label: "AC Operation",
                        id: "EMP129"
                    },
                    {
                        label: "WV/LV Operation",
                        id: "EMP130"
                    },
                    {
                        label: "Aircraft Towing Away",
                        id: "EMP131"
                    }

                ]
            },
            categories: [
                {
                    category: [
                        {
                            start: test1,
                            // end: endTimeFlight,
                            // label: startTimeFlight + "--"+ endTimeFlight
                            // start:"00:00:00",
                            end: test2,
                            label: "Time"
                            // start: "00:00:00",
                            // end: "23:59:59",
                            // label: "Time"
                        }
                    ]
                },{
                    align: "center",
                    category: [
                        {
                            start: test1,
                            end: test2,
                            label: test1 +"  --  "+ test2
                            // start: "00:00:00",
                            // end: "23:59:59",
                            // label: "24 hour"
                        },
                    ]
                }
            ],
            chart: chartconf
        })


        setTimeout(updateGanttChart, 3000);

    }

   var  myChart = new FusionCharts({
        type: "gantt",
        renderAt: "chart-container",
        width: "100%",
        height: "365",
        dataFormat: "json",
        containerBackgroundOpacity: '0',
        dataSource:{
            tasks: {
                showlabels: "1",
                color: "#57b955"

            },
            processes: {
                fontsize: "12",
                isbold: "1",
                align: "Center",
                headertext: "Events",
                headerfontsize: "14",
                headervalign: "middle",
                headeralign: "center",

            },
            categories: [
                // {
                //    bgcolor: "#262a33",
                //    category: [
                //        {
                //            start: "00:00:00",
                //            end: "23:59:59",
                //            label: "Time"
                //        }
                //    ]
                //}
            ],
            chart: chartconf
        }
    }).render();



});
// $("g[class^='raphael-group-test'][class$='-creditgroup']").css({"display":"none !important"});
// $('#raphael-paper-3').css('{"background-color": "rgba(51, 51, 51, 0.425)!important","border-radius": "3px"}');
// $('text').css('{"font-weight":"100!important"}');




